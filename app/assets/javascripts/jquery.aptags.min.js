jQuery.fn.aptags=function(config){__c=jQuery.extend({hiddenFieldName:'__aptags_value',tagDivName:'tagDiv',value:'',minTagLength:1,minTagLengthMessage:'Tag does not meet the minimum requirements',duplicateTagMessage:'Tag already selected'},config);function __createSpans(el,v,__c,f){var r1=/%replace%/g;var values=[];var o=0;var i=0;var s='';var shtml='<span class="apTagSpan" name="aptags_span_%replace%" id="aptags_span_%replace%"><a href="javascript:void(0);">%replace%</a></span>';$(el).trigger('beforeTagAdded',v);values=v.split(',');for(o=0;o<values.length;o++){v=values[o];s=shtml.replace(r1,v);if(v.length<__c.minTagLength){$(el).trigger('tagError',__c.minTagLengthMessage);return false;}if(f){c=$('#'+__c.hiddenFieldName).val().split(',');for(i=0;i<c.length;i++){if(c[i]==v){$(el).trigger('tagError',__c.duplicateTagMessage);return false;}}}$('#'+__c.hiddenFieldName).val($('#'+__c.hiddenFieldName).val()+(($('#'+__c.hiddenFieldName).val().length)?',':'')+v);$(el).val('').focus();$('#'+__c.tagDivName).append(s).bind('click',{__c:__c,el:el},function(e){var el=$(e.target).parent();var v=$(e.target).html();var values=$('#'+e.data.__c.hiddenFieldName).val().split(',');var i=0;$(e.data.el).trigger('beforeTagRemoved',v);el.remove();for(i=0;i<values.length;i++){if(values[i]==v){values.splice(i,1);break;}}$('#'+e.data.__c.hiddenFieldName).val(values.join(','));$(e.data.el).trigger('tagRemoved',v);$(e.data.el).focus();});$(el).trigger('tagAdded',v);}}return this.each(function(){if($('#'+__c.hiddenFieldName).length<=0){var t='<input type="hidden" name="'+__c.hiddenFieldName+'" id="'+__c.hiddenFieldName+'" value="" />';$(this).after(t);var d='<div name="'+__c.tagDivName+'" id="'+__c.tagDivName+'" class="apTagDiv" />';$(this).after(d);}if(__c.value.length>0){var values=__c.value.split(',');var i=0;$('.apTagSpan').remove();for(i=0;i<values.length;i++){__createSpans(this,values[i],__c,false);}}$(this).bind('keypress',{__c:__c},function(e){var c='';var i=0;var v=$(this).val();if(e.keyCode==13){e.stopPropagation();e.preventDefault();__createSpans(this,v,e.data.__c,true);}});});};